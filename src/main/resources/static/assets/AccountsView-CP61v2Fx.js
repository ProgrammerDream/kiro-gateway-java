import{a as v}from"./index-D7fQwz9Q.js";import{h as J,o as _,c as m,a as s,b as l,w as a,t as i,i as T,g,r as d,f as u,E as b,j as K}from"./index-DX4KFW2y.js";const O={class:"page-header",style:{display:"flex","justify-content":"space-between","align-items":"center"}},P={style:{display:"flex",gap:"8px"}},Q={key:0,class:"content-card",style:{"margin-bottom":"16px"}},R={style:{display:"flex",gap:"32px","align-items":"center"}},W={style:{"font-size":"20px","font-weight":"bold",color:"#409eff"}},X={style:{"font-size":"20px","font-weight":"bold",color:"#e6a23c"}},Y={style:{"font-size":"20px","font-weight":"bold",color:"#67c23a"}},Z={style:{flex:"1"}},ee={class:"content-card"},te={key:0},le={style:{color:"#409eff"}},oe={style:{color:"#e6a23c"}},ae={style:{color:"#67c23a"}},se={key:0,style:{"margin-left":"8px"}},ne={key:1,style:{color:"#909399"}},ie={key:2,style:{color:"#f56c6c"}},de={key:3,style:{color:"#c0c4cc"}},pe={__name:"AccountsView",setup(re){const x=g([]),y=g(!1),c=g({name:"",authMethod:"social",credentials:""}),r=g(null),h=g(!1);async function C(){try{x.value=await v.getAccounts()}catch(o){console.error(o)}}async function D(o){o._creditsLoading=!0,o._credits=null,o._creditsError=null;try{let e=await v.getAccountCredits(o.id);e.error?o._creditsError=e.error:o._credits=e}catch{o._creditsError="查询失败"}finally{o._creditsLoading=!1}}async function B(){h.value=!0;try{let o=await v.getCreditsSummary();if(r.value=o,o.accounts)for(let e of o.accounts){let n=x.value.find(k=>k.id===e.id);n&&(e.error?n._creditsError=e.error:n._credits=e)}}catch{b.error("查询额度失败")}finally{h.value=!1}}function N(o,e){if(e<=0)return"#909399";let n=o/e*100;return n>=90?"#f56c6c":n>=70?"#e6a23c":"#67c23a"}async function S(){try{await v.addAccount(c.value),b.success("添加成功"),y.value=!1,c.value={name:"",authMethod:"social",credentials:""},await C()}catch{b.error("添加失败")}}async function q(o){try{await K.confirm("确定删除该账号？","确认"),await v.deleteAccount(o),b.success("删除成功"),await C()}catch{}}function $(o){return o?new Date(o).toLocaleString("zh-CN"):"-"}return J(C),(o,e)=>{var E,U,L;const n=d("el-button"),k=d("el-progress"),p=d("el-table-column"),A=d("el-tag"),j=d("el-table"),z=d("el-input"),V=d("el-form-item"),w=d("el-option"),I=d("el-select"),G=d("el-form"),H=d("el-dialog");return _(),m("div",null,[s("div",O,[e[8]||(e[8]=s("h1",null,"账号管理",-1)),s("div",P,[l(n,{onClick:B,loading:h.value},{default:a(()=>[...e[6]||(e[6]=[u("查询全部额度",-1)])]),_:1},8,["loading"]),l(n,{type:"primary",onClick:e[0]||(e[0]=t=>y.value=!0)},{default:a(()=>[...e[7]||(e[7]=[u("添加账号",-1)])]),_:1})])]),r.value?(_(),m("div",Q,[s("div",R,[s("div",null,[e[9]||(e[9]=s("span",{style:{color:"#909399","font-size":"13px"}},"总额度",-1)),s("div",W,i((E=r.value.totalLimit)==null?void 0:E.toFixed(2)),1)]),s("div",null,[e[10]||(e[10]=s("span",{style:{color:"#909399","font-size":"13px"}},"已使用",-1)),s("div",X,i((U=r.value.totalUsed)==null?void 0:U.toFixed(2)),1)]),s("div",null,[e[11]||(e[11]=s("span",{style:{color:"#909399","font-size":"13px"}},"剩余",-1)),s("div",Y,i((L=r.value.totalAvailable)==null?void 0:L.toFixed(2)),1)]),s("div",Z,[l(k,{percentage:r.value.totalLimit>0?Math.min(100,r.value.totalUsed/r.value.totalLimit*100):0,"stroke-width":16,color:N(r.value.totalUsed,r.value.totalLimit)},null,8,["percentage","color"])])])])):T("",!0),s("div",ee,[l(j,{data:x.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(p,{prop:"name",label:"名称",width:"130"}),l(p,{prop:"authMethod",label:"认证",width:"80"}),l(p,{prop:"status",label:"状态",width:"80"},{default:a(({row:t})=>[l(A,{type:t.status==="active"?"success":"danger",size:"small"},{default:a(()=>[u(i(t.status),1)]),_:2},1032,["type"])]),_:1}),l(p,{label:"额度 (总/已用/剩余)","min-width":"240"},{default:a(({row:t})=>{var f,M,F;return[t._credits?(_(),m("div",te,[s("span",le,i((f=t._credits.usageLimit)==null?void 0:f.toFixed(2)),1),e[12]||(e[12]=s("span",{style:{color:"#909399"}}," / ",-1)),s("span",oe,i((M=t._credits.currentUsage)==null?void 0:M.toFixed(2)),1),e[13]||(e[13]=s("span",{style:{color:"#909399"}}," / ",-1)),s("span",ae,i((F=t._credits.available)==null?void 0:F.toFixed(2)),1),t._credits.subscriptionType?(_(),m("span",se,[l(A,{size:"small",type:"info"},{default:a(()=>[u(i(t._credits.subscriptionType),1)]),_:2},1024)])):T("",!0)])):t._creditsLoading?(_(),m("span",ne,"查询中...")):t._creditsError?(_(),m("span",ie,i(t._creditsError),1)):(_(),m("span",de,"-"))]}),_:1}),l(p,{prop:"requestCount",label:"请求",width:"70"}),l(p,{prop:"creditsTotal",label:"已消耗",width:"90"},{default:a(({row:t})=>{var f;return[u(i((f=t.creditsTotal)==null?void 0:f.toFixed(4)),1)]}),_:1}),l(p,{prop:"lastUsedAt",label:"最后使用",width:"170"},{default:a(({row:t})=>[u(i($(t.lastUsedAt)),1)]),_:1}),l(p,{label:"操作",width:"140"},{default:a(({row:t})=>[l(n,{type:"primary",size:"small",text:"",onClick:f=>D(t)},{default:a(()=>[...e[14]||(e[14]=[u("额度",-1)])]),_:1},8,["onClick"]),l(n,{type:"danger",size:"small",text:"",onClick:f=>q(t.id)},{default:a(()=>[...e[15]||(e[15]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),l(H,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),title:"添加账号",width:"500px"},{footer:a(()=>[l(n,{onClick:e[4]||(e[4]=t=>y.value=!1)},{default:a(()=>[...e[16]||(e[16]=[u("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:S},{default:a(()=>[...e[17]||(e[17]=[u("确定",-1)])]),_:1})]),default:a(()=>[l(G,{model:c.value,"label-width":"80px"},{default:a(()=>[l(V,{label:"名称"},{default:a(()=>[l(z,{modelValue:c.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.name=t),placeholder:"账号名称"},null,8,["modelValue"])]),_:1}),l(V,{label:"认证方式"},{default:a(()=>[l(I,{modelValue:c.value.authMethod,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.authMethod=t)},{default:a(()=>[l(w,{label:"Social",value:"social"}),l(w,{label:"IDC",value:"idc"}),l(w,{label:"Builder ID",value:"builderid"})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"凭证"},{default:a(()=>[l(z,{modelValue:c.value.credentials,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.credentials=t),type:"textarea",rows:6,placeholder:'{"refreshToken":"..."}'},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{pe as default};
